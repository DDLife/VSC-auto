var g=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var L=g((Ne,b)=>{var ae=/- require\s"(.+)".*/g,ue=/- (.+?)\s=\srequire\s"(.+)".*/g,le=/- return\s(.+).*/g,E=/<docs-expose>(.*?)<\/docs-expose>/gs;function M(t){let e=Array.from(t.matchAll(ae)).map(s=>s[1]),r=Array.from(t.matchAll(ue)).reduce((s,i)=>(s[i[1]]=i[2],s),{}),n=Array.from(t.matchAll(le)).map(s=>s[1]).at(-1),o=Array.from(t.matchAll(E)).map(s=>s[1]).join("<hr>");return{deps:e,as:r,ret:n,info:o}}function A(t){return t.split(`
## `)}function v(t){let e=t.indexOf(`
`),r=t.slice(0,e).replace(/\\/g,""),n=t.slice(e+1);return{id:r,content:n}}function j(t){return t.id==="local"}function $(t,e){return t.reduce(([r,n],o)=>e(o)?[[...r,o],n]:[r,[...n,o]],[[],[]])}function W(t){return t.content.split(`
### `).map(v).filter(n=>n.id!="")}function C(t){let e=Array.from(t.content.matchAll(E)).map(r=>r[1]).join("<hr>");return{id:t.id,info:e}}function de(t,e){let r=A(e),[n,...o]=r,s=M(n),i=o.map(v).filter(l=>l.id!=""&&l.id!="References"),[[c],a]=$(i,j),f=c?W(c):[];return{id:t,...s,extern:a.map(l=>C(l)),local:f.map(l=>C(l))}}b.exports={parseHeader:M,splitToParts:A,parsePart:v,isLocal:j,partition:$,splitToLocalChunks:W,parseChunk:C,parse:de}});var U=g((Ue,N)=>{var me=L(),pe=require("path"),x=require("fs");function fe(t,e){let r=pe.dirname(t);return x.existsSync(r)||x.mkdirSync(r,{recursive:!0}),new Promise((n,o)=>{x.writeFile(t,e,s=>{s&&o(s),n()})})}function he(t){return new Promise((e,r)=>{x.existsSync(t)&&x.unlink(t,n=>{n&&r(n),e()}),e()})}function ge(t,e,r){let n=x.readFileSync(t,"utf-8"),o=JSON.stringify(me.parse(r,n));return fe(e,o)}function we(t){return he(t)}N.exports={generate:ge,remove:we}});var F=g((Oe,O)=>{var xe=require("vscode"),q=class{constructor(){}init(){this.outputChannel=xe.window.createOutputChannel("dstUtils"),this.outputChannel.show()}log(e){this.outputChannel.appendLine(e)}};O.exports=new q});var Y=g((Ye,V)=>{var u=require("path"),w=require("fs"),Ve=F();function Pe(t){let e=t;if(w.existsSync(e))return;let r=u.dirname(e);w.existsSync(r)||w.mkdirSync(r,{recursive:!0});let o=`# ${u.basename(e)}

`;return new Promise((s,i)=>{w.writeFile(e,o,c=>{c&&i(c),s()})})}function S(t,e){for(let o of r(t)){let s=u.join(t,o);e({type:"fold",name:o,fullPath:s}),S(s,e)}for(let o of n(t)){let s={type:"file",name:o,fullPath:u.join(t,o)};e(s)}function r(o){return w.readdirSync(o,{withFileTypes:!0}).filter(i=>i.isDirectory()).sort((i,c)=>i.name.localeCompare(c.name)).map(i=>i.name)}function n(o){return w.readdirSync(o,{withFileTypes:!0}).filter(i=>i.isFile()).sort((i,c)=>i.name.localeCompare(c.name)).map(i=>i.name)}}function ye(t,e){let r=u.join(t,"SUMMARY.md"),n=u.join(t,"README.md"),o=c(n),s=w.createWriteStream(r);s.write(`- [:boat:](${o})
`),S(t,i),s.end();function i(a){if(a.type=="fold"){let d=(u.relative(t,a.fullPath).split(u.sep).length-1)*2;s.write(`${" ".repeat(d)}- ${a.name}
`)}else if(a.type=="file"){if(!a.name.endsWith(".md")||a.name=="README.md"||a.name=="SUMMARY.md")return;let d=(u.relative(t,a.fullPath).split(u.sep).length-1)*2;s.write(`${" ".repeat(d)}- [${a.name}](${c(a.fullPath)})
`)}}function c(a){return"/"+u.relative(e,a).replace(/\\/g,"/")}}function Fe(t,e,r,n){S(e,o);function o(s){if(s.type=="file"){if(!s.name.endsWith(n))return;let i=u.relative(e,s.fullPath).slice(0,-n.length),c=u.join(t,i+".md");Pe(c)}}}V.exports={generateSummary:ye,generateDocs:Fe}});var T=g((_e,H)=>{var _=require("vscode"),y=require("path");function De(t){let e=_.workspace.getWorkspaceFolder(t);return e?e.uri.fsPath:_.workspace.rootPath}function ke(t,e,r){let n=r.find(({src:d})=>t.endsWith(d.ext)&&Ce(f(d.dir),t));if(!n||l(t))return;let o=t.slice(0,-n.src.ext.length),s=f(n.src.dir),i=f(n.dst.dir),c=y.relative(s,o).replace(/\\/g,"/"),a=y.join(i,c+n.dst.ext);return{rule:n,srcDir:s,srcFile:t,dstDir:i,dstFile:a,virtualName:c};function f(d){return y.join(e,d)}function l(d){let{src:{dir:te,ext:ne},exclude:re}=n,oe=f(te),se=d.slice(0,-ne.length),ie=y.relative(oe,se).replace(/\\/g,"/");return re.some(ce=>ie.startsWith(ce))}}function Ce(t,e){let r=y.relative(t,e);return r&&!r.startsWith("..")}H.exports={getWorkspaceFolderPath:De,mapToVirtual:ke}});var z=g((Je,J)=>{var D=require("vscode"),He=require("path"),Ie=T(),ve=F();async function I(t,e,r){try{let n=await D.workspace.openTextDocument(t);D.window.showTextDocument(n,e,r)}catch(n){ve.log(n)}}function qe(t){let e=D.ViewColumn.One;return I(t,e,!0)}function Se(t){let e=D.ViewColumn.Two;return I(t,e,!1)}J.exports={openLeft:qe,openRight:Se}});var G=g((ze,B)=>{var Te=require("vscode"),R=class{constructor(){}loadConfig(){this._config=Te.workspace.getConfiguration("dstutils"),this.mdToCode=this.mapRules.map(e=>({src:{dir:e.mdDir,ext:".md"},dst:{dir:e.codeDir,ext:e.ext},exclude:e.exclude})),this.codeToMd=this.mapRules.map(e=>({src:{dir:e.codeDir,ext:e.ext},dst:{dir:e.mdDir,ext:".md"},exclude:e.exclude})),this.mdToCache=this.mapRules.map(e=>({src:{dir:e.mdDir,ext:".md"},dst:{dir:e.cacheDir,ext:".json"},exclude:e.exclude}))}get mapRules(){return this._config.get("mapRules")}};B.exports=new R});var p=require("vscode"),X=U(),Z=Y(),{openLeft:Re,openRight:Ee}=z(),m=F(),{getWorkspaceFolderPath:P,mapToVirtual:k}=T(),h=G(),ee=require("path");function Me(t){m.init(),m.log('Congratulations, "dstUtils" is now active!'),h.loadConfig(),p.workspace.onDidChangeConfiguration(()=>{h.loadConfig()}),p.workspace.onDidSaveTextDocument(r=>{K(r.uri)}),p.workspace.onDidDeleteFiles(r=>{r.files.forEach(n=>Q(n))}),p.workspace.onDidRenameFiles(r=>{r.files.forEach(n=>{Q(n.oldUri),K(n.newUri)})});let e=(r,n)=>t.subscriptions.push(p.commands.registerCommand(r,n));e("dstutils.openCode",()=>je(p.window.activeTextEditor.document.uri)),e("dstutils.openMarkdown",()=>$e(p.window.activeTextEditor.document.uri)),e("dstutils.generateSummary",()=>We(p.window.activeTextEditor.document.uri)),e("dstutils.generateMarkdown",()=>be(p.window.activeTextEditor.document.uri))}function Ae(){}module.exports={activate:Me,deactivate:Ae};async function K(t){let e=t.fsPath,r=P(t),n=k(e,r,h.mdToCache);if(n)try{await X.generate(n.srcFile,n.dstFile,n.virtualName),m.log(`${n.srcFile} -> ${n.dstFile}`)}catch(o){m.log(o)}}async function Q(t){let e=t.fsPath,r=P(t),n=k(e,r,h.mdToCache);if(n)try{await X.remove(n.dstFile),m.log(`remove ${n.dstFile}`)}catch(o){m.log(o)}}function je(t){let e=t.fsPath,r=P(t),n=k(e,r,h.mdToCode);if(!n){m.log(`${e} not match any rule or excluded`);return}return Ee(n.dstFile)}function $e(t){let e=t.fsPath,r=P(t),n=k(e,r,h.codeToMd);if(!n){m.log(`${e} not match any rule or excluded`);return}return Re(n.dstFile)}function We(t){let e=P(t);h.mapRules.map(o=>({mdDir:n(o.mdDir)})).forEach(o=>{Z.generateSummary(o.mdDir,e)}),m.log("generate Summary done");function n(o){return ee.join(e,o)}}function be(t){let e=P(t);h.mapRules.map(o=>({mdDir:n(o.mdDir),codeDir:n(o.codeDir),ext:o.ext})).forEach(o=>{Z.generateDocs(o.mdDir,o.codeDir,e,o.ext)}),m.log("generate Markdown done");function n(o){return ee.join(e,o)}}
